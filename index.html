<!DOCTYPE html>
<html>
<head>
    <title>Face Extractor</title>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
    <style>
        body { font-family: Arial; text-align: center; margin-top: 20px; }
        #status { margin: 20px; font-size: 18px; color: blue; font-weight: bold; }
        #faces { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 30px; }
        .face-box { border: 2px solid black; padding: 5px; }
    </style>
</head>
<body>

<h2>Upload Image â†’ Extract All Faces</h2>
<input type="file" id="imageUpload" accept="image/*" />

<div id="status">Loading modelsâ€¦ please wait</div>

<img id="inputImage" style="max-width: 90%; margin-top: 20px; display: none;" />

<div id="faces"></div>

<script>
async function loadModels() {
    try {
        document.getElementById("status").innerText = "Loading face-api.js modelsâ€¦";

        // All models are in SAME FOLDER as index.html
        const modelPath = "./";

        await faceapi.nets.ssdMobilenetv1.loadFromUri(modelPath);
        await faceapi.nets.faceLandmark68Net.loadFromUri(modelPath);
        await faceapi.nets.faceRecognitionNet.loadFromUri(modelPath);

        document.getElementById("status").innerText = "Models loaded âœ” Upload an image now.";
    } 
    catch (e) {
        document.getElementById("status").innerText = "âŒ Failed to load models";
        console.error("MODEL LOAD ERROR:", e);
    }
}

loadModels();

document.getElementById("imageUpload").addEventListener("change", async function() {
    const file = this.files[0];
    if (!file) return;

    document.getElementById("status").innerText = "Processing imageâ€¦";

    const img = document.getElementById("inputImage");
    img.src = URL.createObjectURL(file);
    img.style.display = "block";

    await new Promise(resolve => img.onload = resolve);

    document.getElementById("status").innerText = "Detecting facesâ€¦";

    const detections = await faceapi
        .detectAllFaces(img)
        .withFaceLandmarks()
        .withFaceDescriptors();

    const facesContainer = document.getElementById("faces");
    facesContainer.innerHTML = "";

    if (detections.length === 0) {
        document.getElementById("status").innerText = "No faces found ðŸ˜•";
        return;
    }

    document.getElementById("status").innerText = `Extracted ${detections.length} faces âœ”`;

    for (let det of detections) {
        const box = det.detection.box;
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = box.width;
        canvas.height = box.height;

        ctx.drawImage(
            img,
            box.x, box.y, box.width, box.height,
            0, 0, box.width, box.height
        );

        const wrapper = document.createElement("div");
        wrapper.className = "face-box";
        wrapper.appendChild(canvas);

        facesContainer.appendChild(wrapper);
    }
});
</script>

</body>
</html>
